<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.7/handlebars.min.js"></script>

<div class="row">
	<div class="alert alert-info" role="alert" id="no-services" style="display: none;">
		Vous n'avez pas d'heures de services enregistrées.
	</div>
</div>

<div class="row" >
	<select class="form-select" aria-label="Default select example" id="weeksDropdown">
		<option selected>Vous n'avez jamais pris votre service</option>
		{{#each weeks}}
			<option value="{{this}}">Semaine du {{this}}</option>
		{{/each}}
	</select>
</div>
<div class="row">
	<h2 style="padding: 1rem 0;">Vous avez travaillé un total de <span id="totalHours">0h</span>.</h2>
	
</div>
<div class="row" >
	<table class="table table-striped table-hover" id="datatable">
		<thead>
			<tr>
			<th scope="col">#</th>
			<th scope="col">Jour</th>
			<th scope="col">Début</th>
			<th scope="col">Fin</th>
			<th scope="col">Durée</th>
			</tr>
		</thead>
		<tbody style="vertical-align: middle;">
			{{#each services}}
				<tr>
					<th scope="row">{{@key}}</th>
					<td>{{userid}}</td>
					<td>{{userid}}</td>
					<td>{{userid}}</td>
					<td>{{userid}}</td>
				</tr>
			{{else}}
			<tr>
				<td colspan="5" style="text-align: center;" class="fw-bold"> Vous n'avez pas d'heures de services pour cette
					semaine</td>
			</tr>
			{{/each}}
		</tbody>
	</table>
</div>

<script defer>
	document.getElementById('weeksDropdown').addEventListener('change', function () {
		const selectedWeek = this.value;

		const userId = {{{json user.id}}}

		fetch(`/services/${userId}?week=${selectedWeek}`)
			.then(response => response.text())
			.then(html => {
				var parser = new DOMParser();
				var doc = parser.parseFromString(html, 'text/html');
				var newDatatable = doc.getElementById('datatable').innerHTML;
				document.getElementById('datatable').innerHTML = newDatatable;
			});
		});
</script>